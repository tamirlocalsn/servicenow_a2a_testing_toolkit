<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceNow A2A Testing - Bash Scripts</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #323130;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #ffffff;
        }
        
        .header {
            background: linear-gradient(90deg, #0078d4 0%, #106ebe 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0 0 10px 0;
            font-weight: 300;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.4;
            position: relative;
        }
        
        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 8px;
            right: 60px;
            color: #999;
            font-size: 0.8em;
            text-transform: uppercase;
        }
        
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 15px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .copy-btn:hover {
            background: #106ebe;
        }
        
        .copy-btn:active {
            transform: translateY(1px);
        }
        
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .inline-code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #d04a02;
        }
        
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .alert-info {
            background-color: #e7f5ff;
            border-left: 4px solid #0078d4;
            color: #005a9e;
        }
        
        .usage-grid, .troubleshooting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .troubleshooting-card {
            background: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .troubleshooting-card h4 {
            margin-top: 0;
            color: #d04a02;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 8px;
        }
        
        .troubleshooting-card ul {
            margin: 10px 0 0 0;
            padding-left: 20px;
        }
        
        .troubleshooting-card li {
            margin-bottom: 5px;
        }
        
        .usage-card {
            background: #f3f2f1;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0078d4;
        }
        
        .usage-card h3 {
            margin-top: 0;
            color: #0078d4;
        }
        
        /* Global Navigation Styles */
        .global-nav {
            background: #323130;
            padding: 15px 0;
            margin: -20px -20px 30px -20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 0 0 8px 8px;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .nav-brand {
            color: white;
            font-weight: 600;
            font-size: 1.1em;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: #d4d4d4;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .nav-links a:hover {
            background: #0078d4;
            color: white;
            text-decoration: none;
        }
        
        .nav-links a.current {
            background: #0078d4;
            color: white !important;
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-links {
                justify-content: center;
                width: 100%;
            }
            
            .nav-links a {
                padding: 6px 10px;
                font-size: 0.85em;
            }
        }
        
        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 15px 0;
        }
        
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #0078d4;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .download-btn:hover {
            background: #106ebe;
            text-decoration: none;
        }
        
        .download-btn svg {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body>
    <!-- Global Navigation -->
    <nav class="global-nav">
        <div class="nav-container">
            <a href="ServiceNow_A2A_Complete_Index.html" class="nav-brand">üè† ServiceNow A2A Testing Toolkit</a>
            <div class="nav-links">
                <a href="ServiceNow_A2A_Complete_Index.html">üè† Home</a>
                <a href="ServiceNow_A2A_Overview.html">üìã Overview</a>
                <a href="ServiceNow_A2A_Python_Client.html">üêç Python Client</a>
                <a href="ServiceNow_A2A_Bash_Scripts.html" class="current">üìú Bash Scripts</a>
                <a href="ServiceNow_A2A_Examples.html">üí° Examples</a>
                <a href="ServiceNow_A2A_Troubleshooting.html">üîß Troubleshooting</a>
            </div>
        </div>
    </nav>

    <div class="header">
        <h1>ServiceNow A2A Testing</h1>
        <p>Bash Scripts Guide</p>
    </div>
    
    <section>
        <h1>üìú Bash Testing Scripts</h1>
        
        <p>The bash scripts provide automated testing capabilities using curl commands. They're perfect for quick validation, automated testing, and debugging ServiceNow A2A implementations.</p>
        
        <div class="alert alert-info">
            <strong>Key Features:</strong> Automated discovery and testing, configurable parameters, detailed error reporting, and manual curl command generation.
        </div>
    </section>
    
    <section>
        <h1>üîß Automated Testing Script</h1>
        
        <div class="script-header">
            <h2>Script</h2>
            <a href="test_servicenow_agent.sh" download class="download-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download Script
            </a>
        </div>
        
        <p>Save this as <span class="inline-code">test_servicenow_agent.sh</span>:</p>
        
        <div class="code-block" data-lang="bash">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre>
#!/bin/bash

# Generic ServiceNow A2A Agent Test Script
# This script generates and executes curl commands to test any ServiceNow agent

set -e  # Exit on any error

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Load configuration from .env file if it exists
if [ -f .env ]; then
    print_status "Loading configuration from .env file..."
    export $(grep -v '^#' .env | xargs)
fi

# Configuration variables with defaults
SERVICENOW_INSTANCE=${SERVICENOW_INSTANCE:-""}
SERVICENOW_AGENT_ID=${SERVICENOW_AGENT_ID:-""}
SERVICENOW_TOKEN=${SERVICENOW_TOKEN:-""}

# Function to show usage
show_usage() {
    echo "Usage: $0 [OPTIONS]"
    echo ""
    echo "Test a ServiceNow A2A agent using curl commands"
    echo ""
    echo "Configuration (via environment variables or .env file):"
    echo "  SERVICENOW_INSTANCE    ServiceNow instance (e.g., company.service-now.com)"
    echo "  SERVICENOW_AGENT_ID    Agent ID to test"
    echo "  SERVICENOW_TOKEN       ServiceNow API key"
    echo ""
    echo "Options:"
    echo "  -i, --instance INSTANCE    ServiceNow instance"
    echo "  -a, --agent-id AGENT_ID    Agent ID"
    echo "  -t, --token TOKEN          API token"
    echo "  -m, --message MESSAGE      Custom message to send (default: test message)"
    echo "  -d, --discovery-only       Only test agent discovery, don't send message"
    echo "      --async                Use async mode (will try sync first if not specified)"
    echo "  -v, --verbose              Verbose output"
    echo "  -h, --help                 Show this help"
    echo ""
    echo "Examples:"
    echo "  $0  # Use .env file configuration"
    echo "  $0 -i company.service-now.com -a agent-id -t api-key"
    echo "  $0 -m \"What can you help me with?\" -v"
    echo "  $0 --discovery-only  # Only test discovery"
}

# Parse command line arguments
CUSTOM_MESSAGE=""
DISCOVERY_ONLY=false
VERBOSE=false
ASYNC_MODE=false

while [[ $# -gt 0 ]]; do
    case $1 in
        -i|--instance)
            SERVICENOW_INSTANCE="$2"
            shift 2
            ;;
        -a|--agent-id)
            SERVICENOW_AGENT_ID="$2"
            shift 2
            ;;
        -t|--token)
            SERVICENOW_TOKEN="$2"
            shift 2
            ;;
        -m|--message)
            CUSTOM_MESSAGE="$2"
            shift 2
            ;;
        -d|--discovery-only)
            DISCOVERY_ONLY=true
            shift
            ;;
        --async)
            ASYNC_MODE=true
            shift
            ;;
        -v|--verbose)
            VERBOSE=true
            shift
            ;;
        -h|--help)
            show_usage
            exit 0
            ;;
        *)
            print_error "Unknown option: $1"
            show_usage
            exit 1
            ;;
    esac
done

# Validate required configuration
if [ -z "$SERVICENOW_INSTANCE" ]; then
    print_error "SERVICENOW_INSTANCE is required"
    show_usage
    exit 1
fi

if [ -z "$SERVICENOW_AGENT_ID" ]; then
    print_error "SERVICENOW_AGENT_ID is required"
    show_usage
    exit 1
fi

if [ -z "$SERVICENOW_TOKEN" ]; then
    print_error "SERVICENOW_TOKEN is required"
    show_usage
    exit 1
fi

# Set default message if not provided
if [ -z "$CUSTOM_MESSAGE" ]; then
    CUSTOM_MESSAGE="Hello! This is a test message. What can you help me with?"
fi

# Clean up the instance URL (remove protocol and trailing slashes)
CLEAN_INSTANCE=$(echo "$SERVICENOW_INSTANCE" | sed -e 's|^https\?://||' -e 's|/$||')

# Build URLs
BASE_URL="https://${CLEAN_INSTANCE}/api/sn_aia/a2a/id"
DISCOVERY_URL="${BASE_URL}/${SERVICENOW_AGENT_ID}/well_known/agent_json"
INVOCATION_URL="https://${CLEAN_INSTANCE}/api/sn_aia/a2a/v1/agent/id/${SERVICENOW_AGENT_ID}"

# Generate unique IDs
REQUEST_ID=$(uuidgen | tr '[:upper:]' '[:lower:]' | tr -d '-')
MESSAGE_ID=$(uuidgen | tr '[:upper:]' '[:lower:]' | tr -d '-')

print_status "ServiceNow A2A Agent Test"
echo "=================================="
echo "Instance: https://$CLEAN_INSTANCE"
echo "Agent ID: $SERVICENOW_AGENT_ID"
echo "API Key:  ${SERVICENOW_TOKEN:0:15}..."
echo "Message:  $CUSTOM_MESSAGE"
echo "=================================="

# Test 1: Agent Discovery
print_status "Step 1: Testing agent discovery..."
echo ""

if [ "$VERBOSE" = true ]; then
    print_status "Discovery URL: $DISCOVERY_URL"
    echo ""
fi

DISCOVERY_RESPONSE=$(curl -s -w "\n%{http_code}" \
    --max-time 30 \
    -H "Content-Type: application/json" \
    -H "x-sn-apikey: $SERVICENOW_TOKEN" \
    -H "User-Agent: ServiceNow-A2A-Test/1.0" \
    "$DISCOVERY_URL" 2&gt;&amp;1)

# Extract HTTP status code (last line) and response body
HTTP_STATUS=$(echo "$DISCOVERY_RESPONSE" | tail -n 1)
DISCOVERY_BODY=$(echo "$DISCOVERY_RESPONSE" | sed '$d')

if [ "$HTTP_STATUS" = "200" ]; then
    print_success "Agent discovery successful!"
    
    # Parse agent info
    AGENT_NAME=$(echo "$DISCOVERY_BODY" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('name', 'Unknown'))" 2&gt;/dev/null || echo "Unknown")
    AGENT_DESC=$(echo "$DISCOVERY_BODY" | python3 -c "import sys, json; data=json.load(sys.stdin); print(data.get('description', 'No description'))" 2&gt;/dev/null || echo "No description")
    
    echo "  Agent Name: $AGENT_NAME"
    echo "  Description: $AGENT_DESC"
    
    if [ "$VERBOSE" = true ]; then
        echo ""
        print_status "Full agent card response:"
        echo "$DISCOVERY_BODY" | python3 -m json.tool 2&gt;/dev/null || echo "$DISCOVERY_BODY"
    fi
else
    print_error "Agent discovery failed! HTTP Status: $HTTP_STATUS"
    echo "Response: $DISCOVERY_BODY"
    exit 1
fi

echo ""

# Exit if discovery-only mode
if [ "$DISCOVERY_ONLY" = true ]; then
    print_success "Discovery-only mode completed successfully!"
    exit 0
fi

# Function to send message to agent
send_message() {
    local mode=$1
    local payload=$2
    
    if [ "$mode" = "sync" ]; then
        print_status "Sending message in SYNC mode..."
    else
        print_status "Sending message in ASYNC mode..."
    fi
    
    if [ "$VERBOSE" = true ]; then
        print_status "Invocation URL: $INVOCATION_URL"
        print_status "Request payload:"
        echo "$payload" | python3 -m json.tool
        echo ""
    fi
    
    local response
    response=$(curl -s -w "\n%{http_code}" \
        --max-time 30 \
        -X POST \
        -H "Content-Type: application/json" \
        -H "x-sn-apikey: $SERVICENOW_TOKEN" \
        -H "User-Agent: ServiceNow-A2A-Test/1.0" \
        -d "$payload" \
        "$INVOCATION_URL" 2>&1)
    
    echo "$response"
}

# Function to parse and display agent response
parse_agent_response() {
    local response=$1
    local http_status=$2
    local message_body=$3
    
    if [ "$http_status" = "200" ]; then
        print_success "Message sent successfully!"
        echo ""
        
        # Extract and display agent response
        print_status "Agent Response:"
        
        # Try to extract the agent's text response
        AGENT_RESPONSES=$(python3 -c "
import sys, json
try:
    data = json.load(sys.stdin)
    result = data.get('result', {})
    
    # Check for sync response
    if 'status' in result and 'message' in result['status']:
        parts = result['status']['message'].get('parts', [])
        for i, part in enumerate(parts):
            if part.get('kind') == 'text':
                print('Response {}: {}'.format(i+1, part.get('text', '')))
    # Check for async response
    elif 'message' in result and 'parts' in result['message']:
        for i, part in enumerate(result['message']['parts']):
            if part.get('kind') == 'text':
                print('Response {}: {}'.format(i+1, part.get('text', '')))
    else:
        print('No text response found in the expected format')
        print('Full response:', json.dumps(data, indent=2))
except Exception as e:
    print('Could not parse agent response: {}'.format(str(e)))
" 2>&1 <<< "$message_body")

        if [ -n "$AGENT_RESPONSES" ]; then
            echo "$AGENT_RESPONSES"
        else
            print_warning "Could not extract agent response text"
        fi
        
        if [ "$VERBOSE" = true ]; then
            echo ""
            print_status "Full response:"
            echo "$message_body" | python3 -m json.tool 2>&1 || echo "$message_body"
        fi
        
        return 0
    else
        print_error "Message sending failed! HTTP Status: $http_status"
        echo "Response: $message_body"
        return 1
    fi
}

# Test 2: Send Message
print_status "Step 2: Sending test message to agent..."
echo ""

# Generate a random callback token for async mode
CALLBACK_TOKEN=$(uuidgen | tr -d '-')
CALLBACK_URL="http://localhost:8080/a2a/callback/$SERVICENOW_AGENT_ID/$CALLBACK_TOKEN"

# Create JSON payload for sync mode
SYNC_JSON_PAYLOAD=$(cat <<EOF
{
  "jsonrpc": "2.0",
  "method": "message/send",
  "params": {
    "message": {
      "role": "user",
      "parts": [
        {
          "kind": "text",
          "text": "$CUSTOM_MESSAGE"
        }
      ],
      "messageId": "$MESSAGE_ID",
      "kind": "user"
    },
    "context": {
      "contextId": null,
      "taskId": null
    },
    "metadata": {},
    "pushNotificationUrl": "$CALLBACK_URL",
    "id": "$REQUEST_ID"
  },
  "id": "$REQUEST_ID"
}
EOF
)

# Create JSON payload for async mode
ASYNC_JSON_PAYLOAD=$(cat <<EOF
{
  "jsonrpc": "2.0",
  "method": "message/send",
  "params": {
    "configuration": {
      "acceptedOutputModes": ["application/json"],
      "historyLength": 0,
      "pushNotificationConfig": {
        "url": "$CALLBACK_URL",
        "token": "$CALLBACK_TOKEN",
        "authentication": {
          "schemes": ["Bearer"]
        }
      }
    },
    "message": {
      "role": "user",
      "kind": "message",
      "parts": [
        {
          "kind": "text",
          "text": "$CUSTOM_MESSAGE"
        }
      ],
      "messageId": "${MESSAGE_ID}_async",
      "contextId": "$REQUEST_ID",
      "taskId": "$REQUEST_ID"
    },
    "metadata": {}
  },
  "id": "${REQUEST_ID}_async"
}
EOF
)

# Try sync mode first if not explicitly in async mode
if [ "$ASYNC_MODE" = false ]; then
    MESSAGE_RESPONSE=$(send_message "sync" "$SYNC_JSON_PAYLOAD")
    HTTP_STATUS=$(echo "$MESSAGE_RESPONSE" | tail -n 1)
    MESSAGE_BODY=$(echo "$MESSAGE_RESPONSE" | sed '$d')
    
    # If sync mode fails with 404 or 405, try async mode
    if [[ "$HTTP_STATUS" =~ ^(404|405)$ ]]; then
        print_warning "Sync mode not supported (HTTP $HTTP_STATUS), trying async mode..."
        echo ""
        ASYNC_MODE=true
    else
        # Parse the sync response
        if ! parse_agent_response "$MESSAGE_RESPONSE" "$HTTP_STATUS" "$MESSAGE_BODY"; then
            exit 1
        fi
    fi
fi

# If in async mode or if sync mode failed with 404/405
if [ "$ASYNC_MODE" = true ]; then
    MESSAGE_RESPONSE=$(send_message "async" "$ASYNC_JSON_PAYLOAD")
    HTTP_STATUS=$(echo "$MESSAGE_RESPONSE" | tail -n 1)
    MESSAGE_BODY=$(echo "$MESSAGE_RESPONSE" | sed '$d')
    
    # Parse the async response
    if ! parse_agent_response "$MESSAGE_RESPONSE" "$HTTP_STATUS" "$MESSAGE_BODY"; then
        exit 1
    fi
fi

echo ""
print_success "All tests completed successfully!"

# Generate curl commands for manual testing
echo ""
print_status "Manual curl commands for testing:"
echo ""
echo "# 1. Test agent discovery:"
echo "curl -H \"Content-Type: application/json\" \\"
echo "     -H \"x-sn-apikey: $SERVICENOW_TOKEN\" \\"
echo "     -H \"User-Agent: ServiceNow-A2A-Test/1.0\" \\"
echo "     \"$DISCOVERY_URL\""
echo ""
echo "# 2. Send message to agent (SYNC mode):"
echo "curl -X POST \\"
echo "     -H \"Content-Type: application/json\" \\"
echo "     -H \"x-sn-apikey: $SERVICENOW_TOKEN\" \\"
echo "     -H \"User-Agent: ServiceNow-A2A-Test/1.0\" \\"
echo "     -d '$SYNC_JSON_PAYLOAD' \\"
echo "     \"$INVOCATION_URL\""
echo ""
echo "# 3. Send message to agent (ASYNC mode):"
echo "curl -X POST \\"
echo "     -H \"Content-Type: application/json\" \\"
echo "     -H \"x-sn-apikey: $SERVICENOW_TOKEN\" \\"
echo "     -H \"User-Agent: ServiceNow-A2A-Test/1.0\" \\"
echo "     -d '$ASYNC_JSON_PAYLOAD' \\"
echo "     \"$INVOCATION_URL\""
            </pre>
        </div>

        <h2>üöÄ Getting Started</h2>
        
        <h3>Prerequisites</h3>
        <ul>
            <li>Bash shell (Linux/macOS/WSL on Windows)</li>
            <li>curl</li>
            <li>uuidgen (usually included in most Linux/macOS systems)</li>
            <li>Python 3 (for JSON parsing)</li>
        </ul>
        
        <h3>Setup</h3>
        <ol>
            <li>Download the script using the button above or copy it to a file named <span class="inline-code">test_servicenow_agent.sh</span></li>
            <li>Make it executable: <span class="inline-code">chmod +x test_servicenow_agent.sh</span></li>
            <li>Create a <span class="inline-code">.env</span> file with your credentials or use command-line parameters</li>
        </ol>
        
        <h2>‚öôÔ∏è Configuration</h2>
        
        <p>You can configure the script in two ways:</p>
        
        <h3>1. Environment Variables</h3>
        <p>Create a <span class="inline-code">.env</span> file in the same directory:</p>
        
        <div class="code-block" data-lang="ini">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre>SERVICENOW_INSTANCE=your-instance.service-now.com
SERVICENOW_AGENT_ID=your-agent-id
SERVICENOW_TOKEN=your-api-token</pre>
        </div>
        
        <h3>2. Command Line Arguments</h3>
        <p>Pass parameters directly when running the script:</p>
        
        <div class="code-block" data-lang="bash">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre>./test_servicenow_agent.sh -i your-instance.service-now.com -a your-agent-id -t your-api-token</pre>
        </div>
        
        <h2>üöÄ Usage Examples</h2>
        
        <div class="usage-grid">
            <div class="usage-card">
                <h3>Basic Usage</h3>
                <p>Test agent with default message (tries sync first, falls back to async if needed):</p>
                <pre>./test_servicenow_agent.sh</pre>
            </div>
            
            <div class="usage-card">
                <h3>Force Async Mode</h3>
                <p>Force the script to use async mode:</p>
                <pre>./test_servicenow_agent.sh --async</pre>
            </div>
            
            <div class="usage-card">
                <h3>Custom Message</h3>
                <p>Send a custom message to the agent:</p>
                <pre>./test_servicenow_agent.sh -m "What services do you provide?"</pre>
            </div>
            
            <div class="usage-card">
                <h3>Discovery Only</h3>
                <p>Test agent discovery without sending a message:</p>
                <pre>./test_servicenow_agent.sh --discovery-only</pre>
            </div>
            
            <div class="usage-card">
                <h3>Verbose Output</h3>
                <p>See detailed request/response information:</p>
                <pre>./test_servicenow_agent.sh -v</pre>
            </div>
            
            <div class="usage-card">
                <h3>Combined Options</h3>
                <p>Combine options for advanced testing:</p>
                <pre>./test_servicenow_agent.sh --async -v -m "Test message"</pre>
            </div>
        </div>
        
        <h2>üìù Output</h2>
        
        <p>The script provides detailed output including:</p>
        <ul>
            <li>Agent discovery status and information</li>
            <li>Operation mode (sync/async) being used</li>
            <li>Request/response details in verbose mode</li>
            <li>Agent responses with proper formatting</li>
            <li>Error messages with troubleshooting hints</li>
            <li>Generated curl commands for manual testing</li>
        </ul>
        
        <div class="alert alert-info">
            <h4>Sync vs Async Mode</h4>
            <p>The script supports two modes of operation:</p>
            <ul>
                <li><strong>Sync Mode</strong> (default): Waits for the agent's response before continuing. Recommended for most use cases.</li>
                <li><strong>Async Mode</strong> (--async): Sends the request and returns immediately. The agent will send the response to the provided callback URL.</li>
            </ul>
            <p>The script automatically falls back to async mode if sync mode is not supported by the agent (HTTP 404/405).</p>
        </div>
        
        <h2>üîß Troubleshooting</h2>
        
        <h3>Common Issues</h3>
        <div class="troubleshooting-grid">
            <div class="troubleshooting-card">
                <h4>Connection Refused</h4>
                <p>If you see connection errors, verify:</p>
                <ul>
                    <li>Instance URL is correct and accessible</li>
                    <li>No firewall is blocking the connection</li>
                    <li>The agent ID is correct and exists</li>
                </ul>
            </div>
            
            <div class="troubleshooting-card">
                <h4>Authentication Errors</h4>
                <p>For 401/403 errors:</p>
                <ul>
                    <li>Verify your API token is valid</li>
                    <li>Check token permissions</li>
                    <li>Ensure token hasn't expired</li>
                </ul>
            </div>
            
            <div class="troubleshooting-card">
                <h4>Async Callback Issues</h4>
                <p>For async mode problems:</p>
                <ul>
                    <li>Ensure the callback URL is accessible</li>
                    <li>Check for proper token authentication</li>
                    <li>Verify the agent supports async mode</li>
                </ul>
            </div>
            
            <div class="troubleshooting-card">
                <h4>Script Errors</h4>
                <p>If the script fails:</p>
                <ul>
                    <li>Run with <code>-v</code> for verbose output</li>
                    <li>Check all required tools are installed</li>
                    <li>Ensure proper line endings (LF, not CRLF)</li>
                </ul>
            </div>
        </div>
        
        <h3>Debugging Tips</h3>
        <ul>
            <li><strong>Connection refused</strong>: Check your instance URL and network connectivity</li>
            <li><strong>401 Unauthorized</strong>: Verify your API token and agent ID</li>
            <li><strong>404 Not Found</strong>: Check if the agent ID is correct and the agent is properly registered</li>
            <li><strong>Timeout</strong>: The agent might be taking too long to respond. Check the agent logs in ServiceNow</li>
        </ul>
        
        <p>For more detailed troubleshooting, see the <a href="ServiceNow_A2A_Troubleshooting.html">Troubleshooting Guide</a>.</p>
    </section>
    
    <script>
        function copyCode(button) {
            const codeBlock = button.nextElementSibling;
            const range = document.createRange();
            range.selectNode(codeBlock);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            
            try {
                const successful = document.execCommand("copy");
                const originalText = button.textContent;
                button.textContent = successful ? "Copied!" : "Failed to copy";
                button.style.background = successful ? "#28a745" : "#dc3545";
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = "#0078d4";
                }, 2000);
            } catch (err) {
                console.error("Failed to copy: ", err);
            }
            
            window.getSelection().removeAllRanges();
        }
    </script>
</body>
</html>
